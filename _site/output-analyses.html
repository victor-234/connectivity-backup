<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Connectivity Analyses - Technical stuff</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link active" data-scroll-target="#getting-started">Getting started</a>
  <ul class="collapse">
  <li><a href="#read-in-manually-collected-startend-pages" id="toc-read-in-manually-collected-startend-pages" class="nav-link" data-scroll-target="#read-in-manually-collected-startend-pages">Read in manually collected start/end pages</a></li>
  <li><a href="#sample-balance-checks" id="toc-sample-balance-checks" class="nav-link" data-scroll-target="#sample-balance-checks">Sample Balance Checks</a></li>
  <li><a href="#update-pdfs-if-not-all-are-downloaded-yet" id="toc-update-pdfs-if-not-all-are-downloaded-yet" class="nav-link" data-scroll-target="#update-pdfs-if-not-all-are-downloaded-yet">Update pdfs if not all are downloaded yet</a></li>
  <li><a href="#extract-text-from-pdfs-if-not-done-so-yet" id="toc-extract-text-from-pdfs-if-not-done-so-yet" class="nav-link" data-scroll-target="#extract-text-from-pdfs-if-not-done-so-yet">Extract text from pdfs if not done so yet</a></li>
  <li><a href="#clean-text-if-not-done-so-yet" id="toc-clean-text-if-not-done-so-yet" class="nav-link" data-scroll-target="#clean-text-if-not-done-so-yet">Clean text if not done so yet</a></li>
  <li><a href="#merge-other-data-to-documents" id="toc-merge-other-data-to-documents" class="nav-link" data-scroll-target="#merge-other-data-to-documents">Merge other data to documents</a></li>
  <li><a href="#merge-manually-coded-section-data" id="toc-merge-manually-coded-section-data" class="nav-link" data-scroll-target="#merge-manually-coded-section-data">Merge manually coded section data</a></li>
  </ul></li>
  <li><a href="#main-analyses" id="toc-main-analyses" class="nav-link" data-scroll-target="#main-analyses">Main analyses</a>
  <ul class="collapse">
  <li><a href="#sec-doc-sample" id="toc-sec-doc-sample" class="nav-link" data-scroll-target="#sec-doc-sample">Document sample selection</a></li>
  <li><a href="#keyword-search" id="toc-keyword-search" class="nav-link" data-scroll-target="#keyword-search">Keyword search</a></li>
  </ul></li>
  <li><a href="#analyses" id="toc-analyses" class="nav-link" data-scroll-target="#analyses">Analyses</a>
  <ul class="collapse">
  <li><a href="#keywords-over-time" id="toc-keywords-over-time" class="nav-link" data-scroll-target="#keywords-over-time">Keywords over time</a></li>
  <li><a href="#keyword-ranking" id="toc-keyword-ranking" class="nav-link" data-scroll-target="#keyword-ranking">Keyword ranking</a></li>
  <li><a href="#keyword-ranking-by-section" id="toc-keyword-ranking-by-section" class="nav-link" data-scroll-target="#keyword-ranking-by-section">Keyword ranking by section</a></li>
  <li><a href="#heatmap-of-hits-in-the-document" id="toc-heatmap-of-hits-in-the-document" class="nav-link" data-scroll-target="#heatmap-of-hits-in-the-document">Heatmap of hits in the document</a></li>
  <li><a href="#cross-sectional-splits" id="toc-cross-sectional-splits" class="nav-link" data-scroll-target="#cross-sectional-splits">Cross-sectional splits</a>
  <ul class="collapse">
  <li><a href="#merge-other-data" id="toc-merge-other-data" class="nav-link" data-scroll-target="#merge-other-data">Merge other data</a></li>
  <li><a href="#descriptives" id="toc-descriptives" class="nav-link" data-scroll-target="#descriptives">Descriptives</a></li>
  <li><a href="#alignment" id="toc-alignment" class="nav-link" data-scroll-target="#alignment">Alignment</a></li>
  <li><a href="#connectivity" id="toc-connectivity" class="nav-link" data-scroll-target="#connectivity">Connectivity</a></li>
  </ul></li>
  <li><a href="#document-descriptives" id="toc-document-descriptives" class="nav-link" data-scroll-target="#document-descriptives">Document descriptives</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Technical stuff</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="434">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># title: "Connectivity Analyses"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># author: ["Maximilian A. MÃ¼ller", "Gaizka Ormazabal", "Thorsten Sellhorn", "Victor Wagner"]</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># institute: ["University of Cologne", "IESE", "LMU Munich School of Management", "LMU Munich School of Management"]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># number-sections: true</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># toc: true</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># format:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     html:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         toc: true</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># jupyter: python3</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fig-width: 0.7</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># echo: false</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># output: asis</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # pdf:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># #         geometry:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># #             - paper=a4paper</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># #         fig-pos: 'h'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># beamer:</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         aspectratio: 169</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#         header-includes: |</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#             \setbeamertemplate{navigation symbols}{}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#             \setbeamertemplate{footline}[page number]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the technical step-by-step procedure. Not interesting.</p>
</div>
</div>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting started</h2>
<ul>
<li>imports</li>
<li>SRN data</li>
<li>(check which firms and documents are needed and which are already here); Currently, we base our analyses on the documents that have already been manually coded (bottom-up); in the future, however, we do it top-down based on Euro Stoxx 600</li>
<li>read in document data
<ul>
<li>read in manually coded documents</li>
<li>check which have to be downloaded (b/c they are not here) and update</li>
<li>check which have to be extracted (b/c it hasnât been done) and update</li>
<li>prepare for later analysis and merge with other data</li>
</ul></li>
</ul>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys, os, json, re</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># path to Dropbox directory with 'pdf', 'pdf-decrypt', 'docs_clean.json' and 'raw_texts.json'</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>BASE_PATH <span class="op">=</span> <span class="st">"/Users/victor.wagner/Dropbox/_Connectivity-Data"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># BASE_PATH = "/Users/victorwagner/Library/CloudStorage/Dropbox/_Connectivity-Data"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>API_PATH  <span class="op">=</span> <span class="st">"https://api.sustainabilityreportingnavigator.com/api"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>companies <span class="op">=</span> pd.read_json(<span class="ss">f'</span><span class="sc">{</span>API_PATH<span class="sc">}</span><span class="ss">/companies'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>documents <span class="op">=</span> pd.read_json(<span class="ss">f'</span><span class="sc">{</span>API_PATH<span class="sc">}</span><span class="ss">/documents'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>indices   <span class="op">=</span> pd.read_json(<span class="ss">f'</span><span class="sc">{</span>API_PATH<span class="sc">}</span><span class="ss">/indices'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>es600 <span class="op">=</span> companies[[<span class="st">'1cc738c1-e6b1-4f2b-8bec-2d963118de59'</span> <span class="kw">in</span> ind <span class="cf">for</span> ind <span class="kw">in</span> companies.indices]]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># es600 = es600[['id', 'name', 'isin', 'country', 'sector']].merge(</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     documents.query('type == "AR" &amp; year in [2018, 2019, 2020, 2021, 2022]')[['id', 'year', 'type', 'company_id']], </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     left_on='id', right_on='company_id',</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     suffixes=('_company', '_document')</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set(es600.name).difference(set(manual_collections_all.name_comp))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="read-in-manually-collected-startend-pages" class="level3">
<h3 class="anchored" data-anchor-id="read-in-manually-collected-startend-pages">Read in manually collected start/end pages</h3>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.mergeManualCollections <span class="im">import</span> mergeManualCollections</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>manual_collections_all <span class="op">=</span> mergeManualCollections([</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/connectivity-manual_collection - lmu_cologne.csv'</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/connectivity-manual_collection-iese - main.csv'</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/connectivity-manual_collection-iese - second_round.csv'</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/connectivity-manual_collection-muhammad - lmu_only.csv'</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'../data/connectivity-manual_collection-parth - lmu_only.csv'</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>manual_collections <span class="op">=</span> manual_collections_all.dropna(subset<span class="op">=</span>[<span class="st">'fs_begin'</span>, <span class="st">'fs_end'</span>, <span class="st">'audit_begin'</span>, <span class="st">'audit_end'</span>], how<span class="op">=</span><span class="st">'any'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'We have'</span>, <span class="bu">len</span>(manual_collections), <span class="st">'manually coded documents, of which'</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      <span class="bu">len</span>(<span class="bu">set</span>(manual_collections.index).difference(<span class="bu">set</span>([x[:<span class="op">-</span><span class="dv">4</span>] <span class="cf">for</span> x <span class="kw">in</span> os.listdir(BASE_PATH <span class="op">+</span> <span class="st">"/pdf/"</span>)]))),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">'are not downloaded.'</span>) </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>([x[:<span class="op">-</span><span class="dv">4</span>] <span class="cf">for</span> x <span class="kw">in</span> os.listdir(BASE_PATH <span class="op">+</span> <span class="st">"/pdf/"</span>)]) <span class="op">&gt;</span> <span class="bu">len</span>(manual_collections.index): </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'There are even'</span>, <span class="bu">len</span>(<span class="bu">set</span>([x[:<span class="op">-</span><span class="dv">4</span>] <span class="cf">for</span> x <span class="kw">in</span> os.listdir(BASE_PATH <span class="op">+</span> <span class="st">"/pdf/"</span>)]).difference(<span class="bu">set</span>(manual_collections.index))),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">'documents too much.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We have 1448 manually coded documents, of which 0 are not downloaded.
There are even 21 documents too much.</code></pre>
</div>
</div>
</section>
<section id="sample-balance-checks" class="level3">
<h3 class="anchored" data-anchor-id="sample-balance-checks">Sample Balance Checks</h3>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>worldscope_msci <span class="op">=</span> pd.read_csv(<span class="st">'../data/worldscope_msci_carbon.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DtypeWarning: Columns (199,340) have mixed types. Specify dtype option on import or set low_memory=False.
  worldscope_msci = pd.read_csv('../data/worldscope_msci_carbon.csv')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>es600a <span class="op">=</span> es600.merge(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    worldscope_msci.query(<span class="st">'year == 2022'</span>).drop_duplicates(<span class="st">'id'</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">"id"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">"_comp"</span>, <span class="st">"_other"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    indicator<span class="op">=</span><span class="va">True</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sample    <span class="op">=</span> es600a[es600a.<span class="bu">id</span>.isin(<span class="bu">list</span>(<span class="bu">set</span>(manual_collections.company_id)))]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>all_es600 <span class="op">=</span> es600a[es600a.<span class="bu">id</span>.isin(<span class="bu">list</span>(<span class="bu">set</span>(manual_collections_all.company_id)))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.doBalanceChecks <span class="im">import</span> balanceCheckMultiple</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sampleCheck2 <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'Sample'</span>, <span class="st">'Full Euro STOXX 600'</span>, <span class="st">'Difference'</span>, <span class="st">'p-val'</span>]</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    balanceCheckMultiple(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'Assets (bn$)'</span>,     <span class="st">'test'</span>: <span class="st">'ttest'</span>,     <span class="st">'attrs'</span>: [<span class="st">'ITEM7230'</span>, <span class="dv">1000000000</span>]},</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'Sales (bn$)'</span>,       <span class="st">'test'</span>: <span class="st">'ttest'</span>,     <span class="st">'attrs'</span>: [<span class="st">'ITEM7240'</span>, <span class="dv">1000000000</span>]},</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'Employees (,000)'</span>,  <span class="st">'test'</span>: <span class="st">'ttest'</span>,     <span class="st">'attrs'</span>: [<span class="st">'ITEM7011'</span>, <span class="dv">1000</span>]},</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'MSCI Emiss. Score'</span>,       <span class="st">'test'</span>: <span class="st">'ttest'</span>,     <span class="st">'attrs'</span>: [<span class="st">'mcarbon_emissions_score'</span>, <span class="dv">1</span>]},</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'MSCI Emiss. Mgmt. Score'</span>, <span class="st">'test'</span>: <span class="st">'ttest'</span>,     <span class="st">'attrs'</span>: [<span class="st">'mcarbon_emissions_score'</span>, <span class="dv">1</span>]},</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'</span><span class="sc">% G</span><span class="st">ER'</span>,             <span class="st">'test'</span>: <span class="st">'chisquare'</span>, <span class="st">'attrs'</span>: [<span class="st">'country'</span>, <span class="st">'Germany'</span>]},</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'</span><span class="sc">% G</span><span class="st">BR'</span>,             <span class="st">'test'</span>: <span class="st">'chisquare'</span>, <span class="st">'attrs'</span>: [<span class="st">'country'</span>, <span class="st">'United Kingdom'</span>]},</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            {<span class="st">'name'</span>: <span class="st">'</span><span class="sc">% F</span><span class="st">RA'</span>,             <span class="st">'test'</span>: <span class="st">'chisquare'</span>, <span class="st">'attrs'</span>: [<span class="st">'country'</span>, <span class="st">'France'</span>]},</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        ], </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        outDF <span class="op">=</span> sampleCheck2,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        sample <span class="op">=</span> sample,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        all_firms <span class="op">=</span> all_es600</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>).to_markdown()</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>|                   |   Sample |   Full Euro STOXX 600 | Difference   | p-val   |
|:------------------|---------:|----------------------:|:-------------|:--------|
| Assets (bn$)      |    79.04 |                 78.47 | 0.57         | 0.97    |
| Sales (bn$)       |    19.53 |                 18.36 | 1.17         | 0.59    |
| Employees (,000)  |    42.6  |                 40.02 | 2.57         | 0.58    |
| MSCI Emiss. Score |     9.11 |                  9.14 | -0.03        | 0.71    |
| % GER             |     0.2  |                  0.12 | 0.08         | 0.8     |
| % GBR             |     0.25 |                  0.23 | 0.01         | 0.97    |
| n                 |   286    |                544    | -            | -       |</code></pre>
</div>
</div>
<div class="alert alert-block alert-danger">
Use the following with caution, this will download, extract and clean all documents if they are not stored locally.
</div>
</section>
<section id="update-pdfs-if-not-all-are-downloaded-yet" class="level3">
<h3 class="anchored" data-anchor-id="update-pdfs-if-not-all-are-downloaded-yet">Update pdfs if not all are downloaded yet</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.downloadPdfs <span class="im">import</span> downloadPdfs</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>doc_status <span class="op">=</span> downloadPdfs(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    BASE_PATH,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">zip</span>(manual_collections[<span class="st">'href_doc'</span>],</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        manual_collections.index)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'There were'</span>, <span class="bu">sum</span>([x <span class="op">==</span> <span class="st">'downloaded'</span> <span class="cf">for</span> x <span class="kw">in</span> doc_status]), <span class="st">'new downloads,'</span>, </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="bu">sum</span>([x <span class="op">==</span> <span class="st">'no download'</span> <span class="cf">for</span> x <span class="kw">in</span> doc_status]), <span class="st">'documents could not be downloaded.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There were 0 new downloads, 0 documents could not be downloaded.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>too_small_docs <span class="op">=</span> [doc <span class="cf">for</span> doc <span class="kw">in</span> os.listdir(BASE_PATH <span class="op">+</span> <span class="st">"/pdf/"</span>) <span class="cf">if</span> os.path.getsize((BASE_PATH<span class="op">+</span><span class="st">'/pdf/'</span><span class="op">+</span>doc)) <span class="op">&lt;</span> <span class="dv">500000</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'There are'</span>, <span class="bu">len</span>(too_small_docs), <span class="st">'documents that are smaller than 0.5 MB (indicating corruption).'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># if len(too_small_docs) &gt; 0:</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     manual_collections_all.loc[[x[:-4] for x in too_small_docs]].to_csv('corrupted_docs.csv')</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     print('A csv-file with a list of corrupted docs has been saved. Please download the docs manually.')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 271 documents that are smaller than 0.5 MB (indicating corruption).</code></pre>
</div>
</div>
</section>
<section id="extract-text-from-pdfs-if-not-done-so-yet" class="level3">
<h3 class="anchored" data-anchor-id="extract-text-from-pdfs-if-not-done-so-yet">Extract text from pdfs if not done so yet</h3>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>raw_texts_old <span class="op">=</span> pd.read_json(<span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/pdf/../raw_texts.json"</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'We already have raw text for'</span>, <span class="bu">len</span>(raw_texts_old.query(<span class="st">'status == "fine"'</span>)), <span class="st">'documents, decrypting and reading'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>     <span class="bu">len</span>(manual_collections)<span class="op">-</span><span class="bu">len</span>(raw_texts_old.query(<span class="st">'status == "fine"'</span>)), <span class="st">'documents now.'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.readTextFromPdf <span class="im">import</span> readTextFromPdf</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>raw_texts_new, doc_status_new <span class="op">=</span> [], []</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>raw_texts_new, doc_status_new <span class="op">=</span> <span class="bu">map</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">list</span>, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">zip</span>(<span class="op">*</span>[readTextFromPdf(BASE_PATH, doc_id) <span class="cf">for</span> doc_id <span class="kw">in</span> manual_collections.index])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>raw_texts_newDict <span class="op">=</span> {doc_id: (r,s) <span class="cf">for</span> doc_id,r,s <span class="kw">in</span> <span class="bu">zip</span>(manual_collections.index, raw_texts_new, doc_status_new)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>We already have raw text for 1185 documents, decrypting and reading 263 documents now.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.updateRawTexts <span class="im">import</span> updateRawTexts</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>raw_texts_final <span class="op">=</span> updateRawTexts(raw_texts_old, raw_texts_newDict)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>raw_texts_final.to_json(<span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/pdf/../raw_texts.json"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'There are'</span>, <span class="bu">sum</span>([x <span class="op">==</span> <span class="st">'problem_decrypting'</span> <span class="cf">for</span> x <span class="kw">in</span> raw_texts_final.status]), <span class="st">'documents with decryption problems'</span>, </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>     <span class="st">'and'</span>, <span class="bu">sum</span>([x <span class="op">==</span> <span class="st">'problem_opening'</span> <span class="cf">for</span> x <span class="kw">in</span> raw_texts_final.status]), <span class="st">'documents that could not be read.'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'This leaves us with a readable sample of'</span>, <span class="bu">sum</span>([x <span class="op">==</span> <span class="st">'fine'</span> <span class="cf">for</span> x <span class="kw">in</span> raw_texts_final.status]), <span class="st">'documents.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 260 documents with decryption problems and 0 documents that could not be read.
This leaves us with a readable sample of 1185 documents.</code></pre>
</div>
</div>
</section>
<section id="clean-text-if-not-done-so-yet" class="level3">
<h3 class="anchored" data-anchor-id="clean-text-if-not-done-so-yet">Clean text if not done so yet</h3>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>docs_cleaned_old <span class="op">=</span> pd.read_json(<span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/docs_clean.json"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'There is already clean data for'</span>, <span class="bu">len</span>(docs_cleaned_old.query(<span class="st">'status == "fine"'</span>)), <span class="st">'documents, cleaning'</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>     <span class="bu">len</span>(raw_texts_final.query(<span class="st">'status == "fine"'</span>))<span class="op">-</span><span class="bu">len</span>(docs_cleaned_old.query(<span class="st">'status == "fine"'</span>)), <span class="st">'documents.'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scripts.updateAndCleanText <span class="im">import</span> updateAndCleanText</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>docs_cleaned_new <span class="op">=</span> updateAndCleanText(docs_cleaned_old, raw_texts_final)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>docs_cleaned_new.to_json(<span class="ss">f"</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/pdf/../docs_clean.json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There is already clean data for 1177 documents, cleaning 8 documents.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> raw_texts_final, raw_texts_new, raw_texts_newDict, raw_texts_old</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">del</span> docs_cleaned_old</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-other-data-to-documents" class="level3">
<h3 class="anchored" data-anchor-id="merge-other-data-to-documents">Merge other data to documents</h3>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docs_cleaned_new.drop(columns=['clean_text_full'], inplace=True)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># docs = docs_cleaned_new.merge(</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     documents[['id', 'company_id', 'year']], </span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     left_index=True, right_on='id'</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ).merge(</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     companies[['id', 'name', 'isin', 'country', 'sector']], </span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     left_on='company_id', right_on='id',</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     suffixes=('', '_company')</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ).set_index(</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     'id', drop=True</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ).drop(</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     'id_company', axis=1</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is better as it preserves 'new' documents found by RA's where no </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># document_id is in the SRN database</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> pd.DataFrame(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="bu">list</span>(docs_cleaned_new.columns) <span class="op">+</span> [<span class="st">'document_id'</span>, <span class="st">'year'</span>, <span class="st">'company_id'</span>, <span class="st">'name'</span>, <span class="st">'isin'</span>, <span class="st">'country'</span>, <span class="st">'sector'</span>]</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc_id, doc <span class="kw">in</span> docs_cleaned_new.iterrows():</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'_'</span> <span class="kw">not</span> <span class="kw">in</span> doc_id:</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        company_id <span class="op">=</span> documents[documents.<span class="bu">id</span> <span class="op">==</span> doc_id][<span class="st">'company_id'</span>].values[<span class="dv">0</span>]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        year       <span class="op">=</span> documents[documents.<span class="bu">id</span> <span class="op">==</span> doc_id][<span class="st">'year'</span>].values[<span class="dv">0</span>]</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        company_id <span class="op">=</span> doc_id[:<span class="dv">36</span>]</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        year       <span class="op">=</span> <span class="bu">int</span>(doc_id[<span class="op">-</span><span class="dv">4</span>:])</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    docs.loc[<span class="bu">len</span>(docs)] <span class="op">=</span> [</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        doc[<span class="dv">0</span>], doc[<span class="dv">1</span>], doc[<span class="dv">2</span>], doc[<span class="dv">3</span>], doc[<span class="dv">4</span>], doc[<span class="dv">5</span>], doc[<span class="dv">6</span>], doc[<span class="dv">7</span>], doc[<span class="dv">8</span>],</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        doc_id,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        year,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        company_id,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        companies[companies.<span class="bu">id</span> <span class="op">==</span> company_id][<span class="st">'name'</span>].values[<span class="dv">0</span>],</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        companies[companies.<span class="bu">id</span> <span class="op">==</span> company_id][<span class="st">'isin'</span>].values[<span class="dv">0</span>],</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        companies[companies.<span class="bu">id</span> <span class="op">==</span> company_id][<span class="st">'country'</span>].values[<span class="dv">0</span>],</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        companies[companies.<span class="bu">id</span> <span class="op">==</span> company_id][<span class="st">'sector'</span>].values[<span class="dv">0</span>]</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>docs.set_index(<span class="st">'document_id'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merge-manually-coded-section-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-manually-coded-section-data">Merge manually coded section data</h3>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>docs <span class="op">=</span> docs.merge(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    manual_collections[[<span class="st">'mda_begin'</span>, <span class="st">'mda_end'</span>, <span class="st">'fs_begin'</span>, <span class="st">'fs_end'</span>, <span class="st">'audit_begin'</span>, <span class="st">'audit_end'</span>]], </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># docs = docs.reset_index(</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ).merge(</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     docs.groupby(</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         ['company_id']).size().reset_index(</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     ).rename(</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         columns={0: 'company_years_avlbl'}), on='company_id'</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ).set_index('index')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop obvious outlier</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>docs.drop(docs[(docs[<span class="st">'isin'</span>] <span class="op">==</span> <span class="st">'ES0130670112'</span>) <span class="op">&amp;</span> (docs[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">2020</span>)].index, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="main-analyses" class="level1">
<h1>Main analyses</h1>
<section id="sec-doc-sample" class="level2">
<h2 class="anchored" data-anchor-id="sec-doc-sample">Document sample selection</h2>
<p>We distributed the EURO Stoxx 600 firms to student assistants to extract information on the structure of annual reports. So far, this resulted in the following documents sample: 1. after removing not readable pdfs, 2. pdfs where no text was scanned, and 3. pdfs with too little words (documents where the average clean text characters are less than 1,500 in a document).</p>
<div class="cell" data-execution_count="382">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>docs0 <span class="op">=</span> docs.query(<span class="st">'status == "fine"'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>docs1 <span class="op">=</span> docs0.query(<span class="st">'clean_text_len &gt; 0'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>docs2 <span class="op">=</span> docs1.query(<span class="st">'avgCleanTextPerPage &gt; 1500'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>TpdfSample <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'less'</span>, <span class="st">'resulting'</span>])</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>TpdfSample.loc[<span class="st">'downloaded pdfs'</span>]       <span class="op">=</span> [<span class="st">''</span>,                             <span class="bu">len</span>(docs)]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>TpdfSample.loc[<span class="st">'1. not readable'</span>]       <span class="op">=</span> [<span class="st">'-'</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">len</span>(docs) <span class="op">-</span><span class="bu">len</span>(docs0)), <span class="bu">len</span>(docs0)]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>TpdfSample.loc[<span class="st">'thereof &lt;0.5MB:'</span>]       <span class="op">=</span> [<span class="st">'('</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">len</span>(too_small_docs))<span class="op">+</span><span class="st">')'</span>, <span class="st">''</span>]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>TpdfSample.loc[<span class="st">'2. zero text scanned'</span>]  <span class="op">=</span> [<span class="st">'-'</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">len</span>(docs0)<span class="op">-</span><span class="bu">len</span>(docs1)), <span class="bu">len</span>(docs1)]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>TpdfSample.loc[<span class="st">'3. chars/page &lt; 1,500'</span>] <span class="op">=</span> [<span class="st">'-'</span><span class="op">+</span><span class="bu">str</span>(<span class="bu">len</span>(docs1)<span class="op">-</span><span class="bu">len</span>(docs2)), <span class="bu">len</span>(docs2)]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#print(TpdfSample.to_markdown(index=False))</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#print('\nThis leaves us with', len(docs2['company_id'].unique()), 'unique firms.')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell tbl-cap-location-top" data-tbl-width="80%" data-execution_count="384">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>TpdfSample</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="384">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<div id="tbl-documents-sample" class="anchored">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<caption>Table&nbsp;1: Sample selection documents</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">less</th>
<th data-quarto-table-cell-role="th">resulting</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">downloaded pdfs</td>
<td></td>
<td>1447</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1. not readable</td>
<td>-271</td>
<td>1176</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">thereof &lt;0.5MB:</td>
<td>(271)</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2. zero text scanned</td>
<td>-37</td>
<td>1139</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3. chars/page &lt; 1,500</td>
<td>-151</td>
<td>988</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</div>
</section>
<section id="keyword-search" class="level2">
<h2 class="anchored" data-anchor-id="keyword-search">Keyword search</h2>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from scripts.findSections import findSections</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>pd.options.mode.chained_assignment <span class="op">=</span> <span class="va">None</span>  <span class="co"># default='warn'</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>docsa <span class="op">=</span> findSections(docs2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="search-patterns" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>search_patterns <span class="op">=</span> [<span class="st">'ghg'</span>, <span class="st">'co2'</span>, <span class="st">'carbon'</span>, <span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'regulatory risk'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(search_patterns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['ghg', 'co2', 'carbon', 'climat', 'emission', 'regulatory risk', 'physical risk', 'transition risk']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lim <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> searchText(doc, search_patterns):</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> []</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> section <span class="kw">in</span> [<span class="st">'fs_text'</span>, <span class="st">'audit_text'</span>, <span class="st">'other_text'</span>]:</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pat <span class="kw">in</span> search_patterns:</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> page, text <span class="kw">in</span> doc[section<span class="op">+</span><span class="st">'_dict'</span>].items():</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> hit <span class="kw">in</span> re.finditer(pat, text):</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                    matches.append({</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'pattern'</span>: pat,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'section'</span>: section[:<span class="op">-</span><span class="dv">5</span>],</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'snippet'</span>: text[hit.start()<span class="op">-</span>lim : hit.start()<span class="op">+</span><span class="bu">len</span>(pat)<span class="op">+</span>lim],</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'page'</span>   : page</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'hits'</span>] <span class="op">=</span> [pd.DataFrame(searchText(doc, search_patterns)) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lim <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> searchText(doc, search_patterns):</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> []</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> section <span class="kw">in</span> [<span class="st">'fs_text'</span>, <span class="st">'audit_text'</span>, <span class="st">'other_text'</span>]:</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> pat <span class="kw">in</span> search_patterns:</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> page, text <span class="kw">in</span> doc[section<span class="op">+</span><span class="st">'_dict'</span>].items():</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> hit <span class="kw">in</span> re.finditer(pat, text):</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                    matches.append({</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'pattern'</span>: pat,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'section'</span>: section[:<span class="op">-</span><span class="dv">5</span>],</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'snippet'</span>: text[hit.start()<span class="op">-</span>lim : hit.start()<span class="op">+</span><span class="bu">len</span>(pat)<span class="op">+</span>lim],</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'page'</span>   : page</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                    })</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'finhits'</span>] <span class="op">=</span> [pd.DataFrame(searchText(doc, [<span class="st">'asset'</span>, <span class="st">'revenue'</span>, <span class="st">'sales'</span>, <span class="st">'employee'</span>])) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'total_hits'</span>]    <span class="op">=</span> [<span class="bu">len</span>(doc.hits) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'avg_hits'</span>]      <span class="op">=</span> docsa[<span class="st">'total_hits'</span>] <span class="op">/</span> docsa[<span class="st">'n_pages'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'total_finhits'</span>] <span class="op">=</span> [<span class="bu">len</span>(doc.finhits) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>docsa[<span class="st">'avg_finhits'</span>]   <span class="op">=</span> docsa[<span class="st">'total_finhits'</span>] <span class="op">/</span> docsa[<span class="st">'n_pages'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># snippets = pd.DataFrame(columns=['document_id', 'isin', 'year', 'pattern', 'section', 'snippet'])</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for idx, doc in docsa.iterrows():</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     for _, hit in doc.hits.iterrows():</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         snippets.loc[len(snippets)] = [idx, doc['isin'], doc['year'], hit['pattern'], hit['section'], hit['snippet']]</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># snippets.info()</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># snippets.to_csv('snippets.csv', index=False)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analyses" class="level1">
<h1>Analyses</h1>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FormatStrFormatter</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>sections <span class="op">=</span> [<span class="st">'fs'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>]</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">sorted</span>(docsa.year.unique())</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#af58ba'</span>, <span class="st">'#ffc61e'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="keywords-over-time" class="level2">
<h2 class="anchored" data-anchor-id="keywords-over-time">Keywords over time</h2>
<div class="cell" data-execution_count="393">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> docsa.copy()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sec <span class="kw">in</span> sections:</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    data[sec<span class="op">+</span><span class="st">'_hits'</span>] <span class="op">=</span> [<span class="bu">len</span>(<span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> hit: hit[<span class="st">'section'</span>] <span class="op">==</span> sec, searchText(doc, search_patterns)))) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'total_hits'</span>] <span class="op">=</span> [<span class="bu">len</span>(searchText(doc, search_patterns)) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="394">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>avg_hits_perSec_perYear <span class="op">=</span> [[np.mean(data.query(<span class="st">'year == @year'</span>)[sec<span class="op">+</span><span class="st">'_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years] <span class="cf">for</span> sec <span class="kw">in</span> sections]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>med_hits_perSec_perYear <span class="op">=</span> [[np.median(data.query(<span class="st">'year == @year'</span>)[sec<span class="op">+</span><span class="st">'_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years] <span class="cf">for</span> sec <span class="kw">in</span> sections]</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>avg_hitsPerPage_perSec_perYear <span class="op">=</span> [[np.mean(data.query(<span class="st">'year == @year'</span>)[sec<span class="op">+</span><span class="st">'_hits'</span>]<span class="op">/</span>data.query(<span class="st">'year == @year'</span>)[<span class="st">'n_pages'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years] <span class="cf">for</span> sec <span class="kw">in</span> sections]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="395">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>fs_hits_avg_yrs <span class="op">=</span>    [np.mean(data.query(<span class="st">'year == @year'</span>)[<span class="st">'fs_hits'</span>])    <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>audit_hits_avg_yrs <span class="op">=</span> [np.mean(data.query(<span class="st">'year == @year'</span>)[<span class="st">'audit_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mda_hits_avg_yrs =   [np.mean(data.query('year == @year')['mda_hits'])   for year in years]</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>other_hits_avg_yrs <span class="op">=</span> [np.mean(data.query(<span class="st">'year == @year'</span>)[<span class="st">'other_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>fs_hits_med_yrs <span class="op">=</span>    [np.median(data.query(<span class="st">'year == @year'</span>)[<span class="st">'fs_hits'</span>])    <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>audit_hits_med_yrs <span class="op">=</span> [np.median(data.query(<span class="st">'year == @year'</span>)[<span class="st">'audit_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># mda_hits_med_yrs =   [np.median(data.query('year == @year')['mda_hits'])   for year in years]</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>other_hits_med_yrs <span class="op">=</span> [np.median(data.query(<span class="st">'year == @year'</span>)[<span class="st">'other_hits'</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="396">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, med_hits_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, med_hits_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for year, n in zip(years, range(len(years))):</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax1.plot(</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         (year, year), </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         (med_hits_perSec_perYear[0][n]+fs_hits_q3[n], </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          med_hits_perSec_perYear[0][n]-fs_hits_q1[n]), </span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#         '_-', color='#ff1f5b', alpha=0.5</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax1.plot(</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         (year, year), </span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         (med_hits_perSec_perYear[1][n]+audit_hits_q3[n], </span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#          med_hits_perSec_perYear[1][n]-audit_hits_q1[n]), </span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#         '_-', color='#009ade', alpha=0.5</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'median hits per section'</span>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> med_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffffff'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, edges<span class="op">=</span><span class="st">'horizontal'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits with IQR')</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309271823.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-90-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="397">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per section'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffffff'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, edges<span class="op">=</span><span class="st">'horizontal'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits with IQR')</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309271823.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-91-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="398">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fs_hits_byY <span class="op">=</span> [data.query(<span class="st">'year == @year'</span>)[<span class="st">'fs_hits'</span>].values <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>fs_hits_ci  <span class="op">=</span> [stats.t.interval(<span class="fl">0.95</span>, <span class="bu">len</span>(hits_byY)<span class="op">-</span><span class="dv">1</span>, loc<span class="op">=</span>hits_byY.mean(), scale<span class="op">=</span>stats.sem(hits_byY)) <span class="cf">for</span> hits_byY <span class="kw">in</span> fs_hits_byY]</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>audit_hits_byY <span class="op">=</span> [data.query(<span class="st">'year == @year'</span>)[<span class="st">'audit_hits'</span>].values <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>audit_hits_ci  <span class="op">=</span> [stats.t.interval(<span class="fl">0.95</span>, <span class="bu">len</span>(hits_byY)<span class="op">-</span><span class="dv">1</span>, loc<span class="op">=</span>hits_byY.mean(), scale<span class="op">=</span>stats.sem(hits_byY)) <span class="cf">for</span> hits_byY <span class="kw">in</span> audit_hits_byY]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="399">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, n <span class="kw">in</span> <span class="bu">zip</span>(years, <span class="bu">range</span>(<span class="bu">len</span>(years))):</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    ax1.plot(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>        (year, year), </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>        (avg_hits_perSec_perYear[<span class="dv">0</span>][n]<span class="op">+</span>(fs_hits_ci[n][<span class="dv">1</span>]<span class="op">-</span>fs_hits_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>         avg_hits_perSec_perYear[<span class="dv">0</span>][n]<span class="op">-</span>(fs_hits_ci[n][<span class="dv">1</span>]<span class="op">-</span>fs_hits_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>), </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'_-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    ax1.plot(</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>        (year, year), </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>        (avg_hits_perSec_perYear[<span class="dv">1</span>][n]<span class="op">+</span>(audit_hits_ci[n][<span class="dv">1</span>]<span class="op">-</span>audit_hits_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>         avg_hits_perSec_perYear[<span class="dv">1</span>][n]<span class="op">-</span>(audit_hits_ci[n][<span class="dv">1</span>]<span class="op">-</span>audit_hits_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>), </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'_-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per section'</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffffff'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, edges<span class="op">=</span><span class="st">'horizontal'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits with IQR')</span></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309271823.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-93-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="400">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fs_hits_byY_win <span class="op">=</span> [stats.mstats.winsorize(data.query(<span class="st">'year == @year'</span>)[<span class="st">'fs_hits'</span>].values, limits<span class="op">=</span>[<span class="dv">0</span>,<span class="fl">0.05</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>fs_hits_byY_avg <span class="op">=</span> [np.mean(x) <span class="cf">for</span> x <span class="kw">in</span> fs_hits_byY_win]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>fs_hits_win_ci  <span class="op">=</span> [stats.t.interval(<span class="fl">0.95</span>, <span class="bu">len</span>(hits_byY)<span class="op">-</span><span class="dv">1</span>, loc<span class="op">=</span>hits_byY.mean(), scale<span class="op">=</span>stats.sem(hits_byY)) <span class="cf">for</span> hits_byY <span class="kw">in</span> fs_hits_byY_win]</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>audit_hits_byY_win <span class="op">=</span> [stats.mstats.winsorize(data.query(<span class="st">'year == @year'</span>)[<span class="st">'audit_hits'</span>].values, limits<span class="op">=</span>[<span class="dv">0</span>,<span class="fl">0.05</span>]) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>audit_hits_byY_avg <span class="op">=</span> [np.mean(x) <span class="cf">for</span> x <span class="kw">in</span> audit_hits_byY_win]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>audit_hits_win_ci  <span class="op">=</span> [stats.t.interval(<span class="fl">0.95</span>, <span class="bu">len</span>(hits_byY)<span class="op">-</span><span class="dv">1</span>, loc<span class="op">=</span>hits_byY.mean(), scale<span class="op">=</span>stats.sem(hits_byY)) <span class="cf">for</span> hits_byY <span class="kw">in</span> audit_hits_byY_win]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\victor.wagner\Anaconda3\lib\site-packages\scipy\stats\_distn_infrastructure.py:2351: RuntimeWarning: invalid value encountered in multiply
  lower_bound = _a * scale + loc
C:\Users\victor.wagner\Anaconda3\lib\site-packages\scipy\stats\_distn_infrastructure.py:2352: RuntimeWarning: invalid value encountered in multiply
  upper_bound = _b * scale + loc</code></pre>
</div>
</div>
<div class="cell" data-execution_count="427">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'figure.dpi'</span>] <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>noHitDocsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year and fs_hits == 0'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>noHitDocsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.1</span>, label<span class="op">=</span><span class="st">'docs w/o fs hits'</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>np.array(docsPerYear)<span class="op">-</span>np.array(noHitDocsPerYear), color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, bottom<span class="op">=</span>noHitDocsPerYear, label<span class="op">=</span><span class="st">'docs w/ fs hits'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, fs_hits_byY_avg, <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, audit_hits_byY_avg, <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year, n <span class="kw">in</span> <span class="bu">zip</span>(years, <span class="bu">range</span>(<span class="bu">len</span>(years))):</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    ax1.plot(</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>        (year, year), </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>        (fs_hits_byY_avg[n]<span class="op">+</span>(fs_hits_win_ci[n][<span class="dv">1</span>]<span class="op">-</span>fs_hits_win_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>         fs_hits_byY_avg[n]<span class="op">-</span>(fs_hits_win_ci[n][<span class="dv">1</span>]<span class="op">-</span>fs_hits_win_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>), </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'_-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    ax1.plot(</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>        (year, year), </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>        (audit_hits_byY_avg[n]<span class="op">+</span>(audit_hits_win_ci[n][<span class="dv">1</span>]<span class="op">-</span>audit_hits_win_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>, </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>         audit_hits_byY_avg[n]<span class="op">-</span>(audit_hits_win_ci[n][<span class="dv">1</span>]<span class="op">-</span>audit_hits_win_ci[n][<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>), </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'_-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per section'</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffffff'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, edges<span class="op">=</span><span class="st">'horizontal'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ax1.set_title(f'n={len(data)} reports with {sum([sum(x) for x in fs_hits_byY])} total hits in fs+notes\n with CI (winsorized)')</span></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>fig.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">0.37</span>,<span class="fl">0.87</span>), fontsize<span class="op">=</span><span class="st">'small'</span>)</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309271823.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061312" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061312-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Development of average hits</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="402">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> make_interp_spline</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>splined_fs    <span class="op">=</span> make_interp_spline(years, fs_hits_byY_avg)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>splined_audit <span class="op">=</span> make_interp_spline(years, audit_hits_byY_avg)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>years_spl <span class="op">=</span> np.linspace(<span class="bu">min</span>(years), <span class="bu">max</span>(years), <span class="dv">500</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>y_fs      <span class="op">=</span> splined_fs(years_spl)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>y_audit   <span class="op">=</span> splined_audit(years_spl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="403">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years_spl, y_fs, <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years_spl, y_audit, <span class="st">'-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for year, n in zip(years, range(len(years))):</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax1.plot(</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         (year, year), </span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         (avg_hits_perSec_perYear[0][n]+fs_hits_ci[n][0], </span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#          avg_hits_perSec_perYear[0][n]+fs_hits_ci[n][1]), </span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#         '_-', color='#ff1f5b', alpha=0.5)</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     ax1.plot(</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#         (year, year), </span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#         (avg_hits_perSec_perYear[1][n]+audit_hits_ci[n], </span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#          avg_hits_perSec_perYear[1][n]+audit_hits_ci[n]), </span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         '_-', color='#009ade', alpha=0.5)</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per section'</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffffff'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, edges<span class="op">=</span><span class="st">'horizontal'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits with IQR')</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309280927.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281056" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281056-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Development of average hits</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="404">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hits_perSec_perYear[<span class="dv">2</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ffc61e'</span>, label<span class="op">=</span><span class="st">'other'</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per section'</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hits_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffc61e'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits')</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309272029.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309271823" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309271823-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Development of average hits</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="405">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hitsPerPage_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hitsPerPage_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hitsPerPage_perSec_perYear[<span class="dv">2</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ffc61e'</span>, label<span class="op">=</span><span class="st">'other'</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per page by section'</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hitsPerPage_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffc61e'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits')</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309272029.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281057" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281057-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Development of hits per page</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="406">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fig, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hitsPerPage_perSec_perYear[<span class="dv">0</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#ff1f5b'</span>, label<span class="op">=</span><span class="st">'fs+notes'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(years, avg_hitsPerPage_perSec_perYear[<span class="dv">1</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'#009ade'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'average hits per page by section'</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>docsPerYear <span class="op">=</span> [<span class="bu">len</span>(data.query(<span class="st">'year == @year'</span>)) <span class="cf">for</span> year <span class="kw">in</span> years]</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> ax1.twinx()</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>ax2.bar(x<span class="op">=</span>years, height<span class="op">=</span>docsPerYear, color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim([<span class="dv">0</span>,<span class="dv">600</span>])</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>ax2.tick_params(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'#docs'</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>plt.table([[<span class="bu">round</span>(y, <span class="dv">2</span>) <span class="cf">for</span> y <span class="kw">in</span> x] <span class="cf">for</span> x <span class="kw">in</span> avg_hitsPerPage_perSec_perYear<span class="op">+</span>[docsPerYear]],</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>         rowLabels<span class="op">=</span>[<span class="st">'fs+notes'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>, <span class="st">'#docs'</span>],</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>         rowColours<span class="op">=</span>[<span class="st">'#ff1f5b'</span>, <span class="st">'#009ade'</span>, <span class="st">'#ffc61e'</span>, <span class="st">'lightgray'</span>],</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>         colLabels<span class="op">=</span>years, loc<span class="op">=</span><span class="st">'bottom'</span>, cellLoc<span class="op">=</span><span class="st">'right'</span>, bbox<span class="op">=</span>[<span class="dv">0</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="dv">1</span>, <span class="fl">0.4</span>])</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks([])</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks([])</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co">#ax1.set_title(f'n={len(data)} reports with {sum(data["total_hits"])} total keyword hits')</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>ax1.legend()<span class="co">#ncol=4, bbox_to_anchor=(0.75,-0.1))</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309272029.png', dpi=400, bbox_inches='tight')</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061313" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061313-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Development of hits per page</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="keyword-ranking" class="level2">
<h2 class="anchored" data-anchor-id="keyword-ranking">Keyword ranking</h2>
<div class="cell" data-execution_count="428">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> docsa.copy()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> search_patterns:</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    data[pat] <span class="op">=</span> [<span class="bu">len</span>(<span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> hit: hit[<span class="st">'pattern'</span>] <span class="op">==</span> pat, searchText(doc, search_patterns)))) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'total_hits'</span>] <span class="op">=</span> [<span class="bu">len</span>(searchText(doc, search_patterns)) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="433">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ax.bar(search_patterns, [np.<span class="bu">sum</span>(data[pat].values) <span class="cf">for</span> pat <span class="kw">in</span> search_patterns], color<span class="op">=</span><span class="st">'#a0b1ba'</span>, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.set_title(f'Distribution of hits per keyword (total hits={sum(data.total_hits)})')</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">6.35</span>,<span class="dv">50500</span>,<span class="ss">f'n=</span><span class="sc">{</span><span class="bu">sum</span>(data.total_hits)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, color<span class="op">=</span><span class="st">'lightgray'</span>, zorder<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig('figures/fig202309272100.png', dpi=400, bbox_inches='tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281109" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281109-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Keyword ranking</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="keyword-ranking-by-section" class="level2">
<h2 class="anchored" data-anchor-id="keyword-ranking-by-section">Keyword ranking by section</h2>
<p>The difference b/w the total number of search hits is because from here, I included <code>ghg</code> and <code>co2</code></p>
<div class="cell" data-execution_count="193">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sections <span class="op">=</span> [<span class="st">'fs'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>totals <span class="op">=</span> {k:v <span class="cf">for</span> k,v <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    sections,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    [[<span class="bu">sum</span>(<span class="bu">len</span>(<span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> hit: (hit[<span class="st">'section'</span>] <span class="op">==</span> sec) <span class="op">&amp;</span> (hit[<span class="st">'pattern'</span>] <span class="op">==</span> pat), searchText(doc, search_patterns))))</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()) </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> pat <span class="kw">in</span> search_patterns] </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>     <span class="cf">for</span> sec <span class="kw">in</span> sections]</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="431">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>label_locs <span class="op">=</span> np.arange(<span class="bu">len</span>(search_patterns))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sec <span class="kw">in</span> <span class="bu">list</span>(totals.keys())[:<span class="dv">2</span>]:</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width <span class="op">*</span> multiplier</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    ax.bar(label_locs<span class="op">+</span>offset, totals[sec], width<span class="op">=</span>width, label<span class="op">=</span>sec, edgecolor<span class="op">=</span><span class="st">'w'</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax.bar_label(rects, padding=3)</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(label_locs<span class="op">+</span>width)</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(search_patterns)</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('figures/fig202309272158.png', dpi=400, bbox_inches='tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281112" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281112-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Keyword ranking by section</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="432">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>label_locs <span class="op">=</span> np.arange(<span class="bu">len</span>(search_patterns))</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sec, byKeyword <span class="kw">in</span> totals.items():</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width <span class="op">*</span> multiplier</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    ax.bar(label_locs<span class="op">+</span>offset, byKeyword, width<span class="op">=</span>width, label<span class="op">=</span>sec, edgecolor<span class="op">=</span><span class="st">'w'</span>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ax.bar_label(rects, padding=3)</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(label_locs<span class="op">+</span>width)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(search_patterns)</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig('figures/fig202309272147.png', dpi=400, bbox_inches='tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281111" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281111-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Keyword ranking by section</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="heatmap-of-hits-in-the-document" class="level2">
<h2 class="anchored" data-anchor-id="heatmap-of-hits-in-the-document">Heatmap of hits in the document</h2>
<div class="cell" data-execution_count="196">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>data1 <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'document_id'</span>, <span class="st">'company_id'</span>, <span class="st">'year'</span>, <span class="st">'fs_begin'</span>, <span class="st">'fs_end'</span>, <span class="st">'audit_begin'</span>, <span class="st">'audit_end'</span>, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pattern'</span>, <span class="st">'section'</span>, <span class="st">'page'</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc_id, doc <span class="kw">in</span> docsa.iterrows():</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, hit <span class="kw">in</span> doc.hits.iterrows():</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (hit.section <span class="op">==</span> <span class="st">'fs'</span>) <span class="kw">or</span> (hit.section <span class="op">==</span> <span class="st">'audit'</span>):</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>            data1.loc[<span class="bu">len</span>(data1)] <span class="op">=</span> [</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                doc_id, doc.company_id, doc.year, doc.fs_begin, doc.fs_end, doc.audit_begin, doc.audit_end,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>                hit.pattern, hit.section, hit.page</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>            ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="197">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>data1_onlyFS    <span class="op">=</span> data1.query(<span class="st">'section == "fs"'</span>).drop([<span class="st">'audit_begin'</span>, <span class="st">'audit_end'</span>, <span class="st">'section'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>data1_onlyaudit <span class="op">=</span> data1.query(<span class="st">'section == "audit"'</span>).drop([<span class="st">'fs_begin'</span>, <span class="st">'fs_end'</span>, <span class="st">'section'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="198">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data1_onlyFS_noMult <span class="op">=</span> data1_onlyFS[[<span class="st">','</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> data1_onlyFS[<span class="st">'fs_begin'</span>]]]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>data1_onlyaudit_noMult <span class="op">=</span> data1_onlyaudit[[<span class="st">','</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> data1_onlyaudit[<span class="st">'audit_begin'</span>]]]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'By restricting to no multi-start sections, we lose'</span>, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>      <span class="bu">len</span>(data1_onlyFS)<span class="op">-</span><span class="bu">len</span>(data1_onlyFS_noMult), <span class="st">'snippets.</span><span class="ch">\n</span><span class="st">'</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">'Left:'</span>, <span class="bu">len</span>(data1_onlyFS_noMult))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>By restricting to no multi-start sections, we lose 90 snippets.
 Left: 6327</code></pre>
</div>
</div>
<div class="cell" data-execution_count="199">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data1_onlyFS_noMult[<span class="st">'location'</span>] <span class="op">=</span> [<span class="bu">int</span>(snip[<span class="st">'page'</span>]) <span class="op">/</span> <span class="bu">int</span>(snip[<span class="st">'fs_end'</span>]) <span class="cf">for</span> _,snip <span class="kw">in</span> data1_onlyFS_noMult.iterrows()]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>data1_onlyaudit_noMult[<span class="st">'location'</span>] <span class="op">=</span> [<span class="bu">int</span>(snip[<span class="st">'page'</span>]) <span class="op">/</span> <span class="bu">int</span>(snip[<span class="st">'audit_end'</span>]) <span class="cf">for</span> _,snip <span class="kw">in</span> data1_onlyaudit_noMult.iterrows()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="200">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">3</span>, ncols<span class="op">=</span><span class="dv">1</span>, sharex<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">6</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>customprops <span class="op">=</span> <span class="bu">dict</span>(linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ax.boxplot(data1_onlyFS_noMult['location'], showfliers=0, showmeans=1, meanline=1, showcaps=0, </span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co">#            boxprops=customprops, whiskerprops=customprops, capprops=customprops, </span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co">#            medianprops=dict(color='#ff1f5b'), meanprops=dict(linestyle=':', linewidth=1, color='gray'))</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, year <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="dv">2018</span>, <span class="dv">2020</span>, <span class="dv">2022</span>]):</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    sns.stripplot(data<span class="op">=</span>data1_onlyFS_noMult.query(<span class="st">'year == @year'</span>), </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                  x<span class="op">=</span><span class="st">'location'</span>, y<span class="op">=</span><span class="st">'pattern'</span>, </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>                  color<span class="op">=</span>colors[n], alpha<span class="op">=</span><span class="fl">0.4</span>, size<span class="op">=</span><span class="fl">2.5</span>, ax<span class="op">=</span>ax[n], order<span class="op">=</span>search_patterns)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    ax[n].grid(color<span class="op">=</span><span class="st">'lightgray'</span>, axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'dashed'</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    ax[n].set_ylabel(<span class="st">''</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    ax[n].set_title(year)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_xlim([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_xlabel(<span class="st">''</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309282020" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309282020-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Relative location</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="cross-sectional-splits" class="level2">
<h2 class="anchored" data-anchor-id="cross-sectional-splits">Cross-sectional splits</h2>
<p>First, create a more lightweight data structure</p>
<div class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>docsl <span class="op">=</span> docs.loc[docsa.index].copy()[[<span class="st">'year'</span>, <span class="st">'isin'</span>, <span class="st">'company_id'</span>, <span class="st">'country'</span>, <span class="st">'sector'</span>, <span class="st">'n_pages'</span>, <span class="st">'clean_text_len'</span>]]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sec <span class="kw">in</span> [<span class="st">'fs'</span>, <span class="st">'audit'</span>, <span class="st">'other'</span>]:</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    docsl[sec<span class="op">+</span><span class="st">'_hit'</span>] <span class="op">=</span> [<span class="bu">len</span>(<span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> hit: hit[<span class="st">'section'</span>] <span class="op">==</span> sec, searchText(doc, search_patterns)))) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pat <span class="kw">in</span> search_patterns:</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>        docsl[pat<span class="op">+</span><span class="st">'_'</span><span class="op">+</span>sec<span class="op">+</span><span class="st">'_hit'</span>] <span class="op">=</span> [<span class="bu">len</span>(<span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> hit: (hit[<span class="st">'pattern'</span>] <span class="op">==</span> pat) <span class="kw">and</span> (hit[<span class="st">'section'</span>] <span class="op">==</span> sec), searchText(doc, search_patterns)))) <span class="cf">for</span> _, doc <span class="kw">in</span> docsa.iterrows()]</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>docsl_backup <span class="op">=</span> docsl.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="merge-other-data" class="level3">
<h3 class="anchored" data-anchor-id="merge-other-data">Merge other data</h3>
<div class="cell" data-execution_count="232">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>etsmatch <span class="op">=</span> pd.read_stata(<span class="ss">f'</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/research_data/OrbisETSMatch.dta'</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>etsmatch[<span class="st">'ets'</span>] <span class="op">=</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="244">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>docsl <span class="op">=</span> docsl.reset_index(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>).merge(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    etsmatch[[<span class="st">'ISINnumber'</span>, <span class="st">'ets'</span>]], </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span><span class="st">'isin'</span>, right_on<span class="op">=</span><span class="st">'ISINnumber'</span>, </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'outer'</span>, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    indicator<span class="op">=</span><span class="va">True</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>).query(</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'_merge != "right_only"'</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>).drop_duplicates(</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'isin'</span>, <span class="st">'year'</span>], keep<span class="op">=</span><span class="st">'last'</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>).drop(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'_merge'</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>).set_index(</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'document_id'</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'ets'</span>].fillna(<span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="245">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>worldscope_msci <span class="op">=</span> pd.read_csv(<span class="ss">f'</span><span class="sc">{</span>BASE_PATH<span class="sc">}</span><span class="ss">/research_data/worldscope_msci_carbon.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DtypeWarning: Columns (199,340) have mixed types. Specify dtype option on import or set low_memory=False.
  worldscope_msci = pd.read_csv(f'{BASE_PATH}/research_data/worldscope_msci_carbon.csv')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>docsl <span class="op">=</span> docsl.reset_index(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>).merge(</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>    worldscope_msci, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'isin'</span>, <span class="st">'year'</span>],</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    indicator<span class="op">=</span><span class="va">True</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>).drop_duplicates(</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'isin'</span>, <span class="st">'year'</span>], keep<span class="op">=</span><span class="st">'last'</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>).query(</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"_merge != 'right_only'"</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>).drop(</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'_merge'</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>).set_index(</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'document_id'</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="251">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>readiness_2022 <span class="op">=</span> pd.read_json(API_PATH<span class="op">+</span><span class="st">'/companies/readiness_summary_all?standard_family=esrs&amp;year=2022&amp;include_unverified=true'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>readiness_2021 <span class="op">=</span> pd.read_json(API_PATH<span class="op">+</span><span class="st">'/companies/readiness_summary_all?standard_family=esrs&amp;year=2021&amp;include_unverified=true'</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>readiness_2020 <span class="op">=</span> pd.read_json(API_PATH<span class="op">+</span><span class="st">'/companies/readiness_summary_all?standard_family=esrs&amp;year=2020&amp;include_unverified=true'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>readiness_2022[<span class="st">'esrs_emissM'</span>] <span class="op">=</span> [pd.DataFrame(r).query(<span class="st">'topic == "GHG emissions (metrics)"'</span>)[<span class="st">'readiness_extended'</span>].values[<span class="dv">0</span>] <span class="cf">for</span> r <span class="kw">in</span> readiness_2022.by_topic2]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>readiness_2022[<span class="st">'year'</span>] <span class="op">=</span> <span class="dv">2022</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>readiness_2021[<span class="st">'esrs_emissM'</span>] <span class="op">=</span> [pd.DataFrame(r).query(<span class="st">'topic == "GHG emissions (metrics)"'</span>)[<span class="st">'readiness_extended'</span>].values[<span class="dv">0</span>] <span class="cf">for</span> r <span class="kw">in</span> readiness_2021.by_topic2]</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>readiness_2021[<span class="st">'year'</span>] <span class="op">=</span> <span class="dv">2021</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>readiness_2020[<span class="st">'esrs_emissM'</span>] <span class="op">=</span> [pd.DataFrame(r).query(<span class="st">'topic == "GHG emissions (metrics)"'</span>)[<span class="st">'readiness_extended'</span>].values[<span class="dv">0</span>] <span class="cf">for</span> r <span class="kw">in</span> readiness_2021.by_topic2]</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>readiness_2020[<span class="st">'year'</span>] <span class="op">=</span> <span class="dv">2020</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="253">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>docsl <span class="op">=</span> docsl.reset_index(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>).merge(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    pd.concat(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>            readiness_2022[[<span class="st">'company_id'</span>, <span class="st">'year'</span>, <span class="st">'esrs_emissM'</span>]],</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>            readiness_2021[[<span class="st">'company_id'</span>, <span class="st">'year'</span>, <span class="st">'esrs_emissM'</span>]],</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>            readiness_2020[[<span class="st">'company_id'</span>, <span class="st">'year'</span>, <span class="st">'esrs_emissM'</span>]],</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        ignore_index<span class="op">=</span><span class="va">True</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">"outer"</span>,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'company_id'</span>, <span class="st">'year'</span>],</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    indicator<span class="op">=</span><span class="va">True</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>).query(</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'_merge != "right_only"'</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>).set_index(</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'document_id'</span></span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>).drop(</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'_merge'</span>, axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="357">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>docsl.drop(<span class="st">'7903d3ee-6e26-457d-84b8-b396958609b7'</span>, axis<span class="op">=</span><span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="descriptives" class="level3">
<h3 class="anchored" data-anchor-id="descriptives">Descriptives</h3>
<div class="cell" data-execution_count="257">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'axes.prop_cycle'</span>] <span class="op">=</span> mpl.cycler(color<span class="op">=</span>[<span class="st">'#FF1F5B'</span>, <span class="st">'#00CD6C'</span>, <span class="st">'#009ADE'</span>, <span class="st">'#AF58BA'</span>, <span class="st">'#FFC61E'</span>, <span class="st">'#F28522'</span>, <span class="st">'#A0B1BA'</span>, <span class="st">'#A6761D'</span>, <span class="st">'#E9002D'</span>, <span class="st">'#FFAA00'</span>, <span class="st">'#00B000'</span>])</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>mpl.rcParams[<span class="st">'axes.prop_cycle'</span>] <span class="op">=</span> mpl.cycler(color<span class="op">=</span>[<span class="st">'#4472c4ff'</span>, <span class="st">'#ed7d31ff'</span>, <span class="st">'#a5a5a5ff'</span>, <span class="st">'#ffc000ff'</span>, <span class="st">'#5b9bd5ff'</span>, <span class="st">'#70ad47ff'</span>, <span class="st">'#264478ff'</span>, <span class="st">'#9e480eff'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="448">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>ax.plot(docsl.groupby(<span class="st">'year'</span>)[<span class="st">'fs_hit'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">sum</span>(x<span class="op">==</span><span class="dv">0</span>)<span class="op">/</span><span class="bu">len</span>(x)), <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'fs'</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>ax.plot(docsl.groupby(<span class="st">'year'</span>)[<span class="st">'audit_hit'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">sum</span>(x<span class="op">==</span><span class="dv">0</span>)<span class="op">/</span><span class="bu">len</span>(x)), <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"No hits"</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(years)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061332" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061332-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Percentage of documents w/o a hit</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="436">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>ax.plot(docsl.groupby(<span class="st">'year'</span>)[<span class="st">'fs_hit'</span>].mean(), <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'fs'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>ax.plot(docsl.groupby(<span class="st">'year'</span>)[<span class="st">'audit_hit'</span>].mean(), <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'audit'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(years)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061330" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061330-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Development of average hits</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="437">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="bu">len</span>(years))</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'year'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    ax.bar(years, means, width<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061333" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061333-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Development of average hits by keyword</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="alignment" class="level3">
<h3 class="anchored" data-anchor-id="alignment">Alignment</h3>
<div class="cell" data-execution_count="438">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'ets'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'No ETS'</span>, <span class="st">'ETS'</span>], means, width<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061334" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061334-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Alignment measured by ETS participation</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="439">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'high_climRiskExp'</span>] <span class="op">=</span> [x <span class="op">&gt;</span> np.nanmedian(docsl.mcarbon_emissions_exp_score) <span class="cf">if</span> <span class="op">~</span>np.isnan(x) <span class="cf">else</span> <span class="va">None</span> <span class="cf">for</span> x <span class="kw">in</span> docsl.mcarbon_emissions_exp_score.values]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="440">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'high_climRiskExp'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'Low climate risk'</span>, <span class="st">'High climate risk'</span>], means, width<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061335" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061335-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Alignment measured by MSCI Climate Exposure Score</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="441">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sortIntoQuartile(value, array):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    q1 <span class="op">=</span> np.nanquantile(array, <span class="fl">0.25</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    q2 <span class="op">=</span> np.nanquantile(array, <span class="fl">0.50</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    q3 <span class="op">=</span> np.nanquantile(array, <span class="fl">0.75</span>)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">~</span>np.isnan(value):</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> value <span class="op">&gt;</span> q3:</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'q4'</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> value <span class="op">&gt;</span> q2:</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'q3'</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> value <span class="op">&gt;</span> q1:</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'q2'</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">'q1'</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="365">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'quart_climRiskExp'</span>] <span class="op">=</span> [sortIntoQuartile(x, docsl.mcarbon_emissions_exp_score) <span class="cf">for</span> x <span class="kw">in</span> docsl.mcarbon_emissions_exp_score.values]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="366">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>fs_hits_perClimRiskQuart <span class="op">=</span> [docsl.query(<span class="st">'quart_climRiskExp == @q'</span>)[<span class="st">'fs_hit'</span>].values <span class="cf">for</span> q <span class="kw">in</span> [<span class="st">'q1'</span>, <span class="st">'q2'</span>, <span class="st">'q3'</span>, <span class="st">'q4'</span>]]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>fs_hits_perClimRiskQuart_ci <span class="op">=</span> [stats.t.interval(<span class="fl">0.95</span>, <span class="bu">len</span>(hits_byQ)<span class="op">-</span><span class="dv">1</span>, loc<span class="op">=</span>hits_byQ.mean(), scale<span class="op">=</span>stats.sem(hits_byQ)) <span class="cf">for</span> hits_byQ <span class="kw">in</span> fs_hits_perClimRiskQuart]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="442">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">4</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'quart_climRiskExp'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'q1'</span>, <span class="st">'q2'</span>, <span class="st">'q3'</span>, <span class="st">'q4'</span>], means, width<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n, q <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'q1'</span>, <span class="st">'q2'</span>, <span class="st">'q3'</span>, <span class="st">'q4'</span>]):</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    ax.plot([q,q], </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            [</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>                fs_hits_perClimRiskQuart_ci[n][<span class="dv">0</span>],</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>                fs_hits_perClimRiskQuart_ci[n][<span class="dv">1</span>]</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>            ], <span class="st">'k_-'</span>, linewidth<span class="op">=</span><span class="fl">0.75</span>)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"MSCI Exposure Score Quartile"</span>)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.17</span>))</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061336" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061336-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;15: Alignment measured by MSCI Climate Exposure Score Quartiles</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="444">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> [<span class="st">'q1'</span>, <span class="st">'q2'</span>, <span class="st">'q3'</span>, <span class="st">'q4'</span>]:</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(years, docsl[docsl.quart_climRiskExp <span class="op">==</span> q].groupby(<span class="st">'year'</span>)[<span class="st">'fs_hit'</span>].mean().values, label<span class="op">=</span>q)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(years)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061337" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061337-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;16: Alignment over time measured by MSCI Climate Exposure Score Quartiles</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="447">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> [<span class="st">'q1'</span>, <span class="st">'q2'</span>, <span class="st">'q3'</span>, <span class="st">'q4'</span>]:</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(years, docsl[docsl.quart_climRiskExp <span class="op">==</span> q].groupby(<span class="st">'year'</span>)[<span class="st">'fs_hit'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">sum</span>(x<span class="op">==</span><span class="dv">0</span>)<span class="op">/</span><span class="bu">len</span>(x)), label<span class="op">=</span>q)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(years)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Percentage of documents w/o hits"</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>ax.set_ylim([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.85</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-154-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="connectivity" class="level3">
<h3 class="anchored" data-anchor-id="connectivity">Connectivity</h3>
<div class="cell" data-execution_count="327">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'high_emissDiscl'</span>] <span class="op">=</span> [x <span class="op">&gt;=</span> <span class="bu">round</span>(np.nanmedian(docsl.mcarbon_emissions_mgmt_score),<span class="dv">2</span>) <span class="cf">if</span> <span class="op">~</span>np.isnan(x) <span class="cf">else</span> np.NaN <span class="cf">for</span> x <span class="kw">in</span> docsl.mcarbon_emissions_mgmt_score]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="370">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'n all docs</span><span class="ch">\t\t</span><span class="st">'</span>, <span class="bu">len</span>(docsl))</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'docs above median</span><span class="ch">\t</span><span class="st">'</span>, <span class="bu">len</span>(docsl[docsl[<span class="st">'high_emissDiscl'</span>] <span class="op">==</span> <span class="va">True</span>]))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'docs below median</span><span class="ch">\t</span><span class="st">'</span>, <span class="bu">len</span>(docsl[docsl[<span class="st">'high_emissDiscl'</span>] <span class="op">==</span> <span class="va">False</span>]))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'docs w/ na</span><span class="ch">\t\t</span><span class="st">'</span>, <span class="bu">sum</span>(docsl[<span class="st">'high_emissDiscl'</span>].isna()))</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'docs where score==median'</span>, <span class="bu">sum</span>([x <span class="op">==</span> np.nanmedian(docsl[<span class="st">'mcarbon_emissions_mgmt_score'</span>]) <span class="cf">for</span> x <span class="kw">in</span> docsl[<span class="st">'mcarbon_emissions_mgmt_score'</span>]]))</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'332-222 = </span><span class="ch">\t\t</span><span class="st">'</span>, <span class="dv">332</span><span class="op">-</span><span class="dv">222</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n all docs       985
docs above median    525
docs below median    382
docs w/ na       78
docs where score==median 138
332-222 =        110</code></pre>
</div>
</div>
<div class="cell" data-execution_count="449">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'high_emissDiscl'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'Low Disclosure Scores'</span>, <span class="st">'High Disclosure Scores'</span>], means, width<span class="op">=</span><span class="fl">0.8</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061338" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061338-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;17: SustRep measured by MSCI Climate Emission Disclosure Score</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="450">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>patterns <span class="op">=</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>labelloc <span class="op">=</span> np.arange(<span class="bu">len</span>(patterns))</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> state, label <span class="kw">in</span> <span class="bu">zip</span>([<span class="va">False</span>, <span class="va">True</span>], [<span class="st">'Low Disclosure Scores'</span>, <span class="st">'High Disclosure Scores'</span>]):</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width<span class="op">*</span>multiplier</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>    rects <span class="op">=</span> ax.bar(labelloc<span class="op">+</span>offset, </span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                   [docsl[docsl.high_emissDiscl <span class="op">==</span> state][<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean() <span class="cf">for</span> pat <span class="kw">in</span> patterns], </span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                   width<span class="op">=</span>width, label<span class="op">=</span>label, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(labelloc<span class="op">+</span>width<span class="op">*</span><span class="fl">0.5</span>, patterns)</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.95</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061339" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061339-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;18: SustRep measured by MSCI Climate Emission Disclosure Score by keyword</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="373">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'high_outsideHit'</span>] <span class="op">=</span> [x <span class="op">&gt;=</span> docsl[<span class="st">'other_hit'</span>].quantile() <span class="cf">for</span> x <span class="kw">in</span> docsl.other_hit]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="453">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'high_outsideHit'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean().values</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'Low Outside Hits'</span>, <span class="st">'High Outside Hits'</span>], means, width<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.1</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061340" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061340-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19: SustRep measured by Keyword Hits outside of FS and Audit</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="375">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>ax.plot(docsl.other_hit, docsl.fs_hit, <span class="st">'.'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Search hits in FS + Notes'</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Search hits outside of FS + Notes'</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">#ax.grid(axis="y")</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-163-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="376">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>labelloc <span class="op">=</span> np.arange(<span class="dv">2</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> state, label <span class="kw">in</span> <span class="bu">zip</span>([<span class="va">False</span>, <span class="va">True</span>], [<span class="st">'Low Outside Hits'</span>, <span class="st">'High Outside Hits'</span>]):</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width<span class="op">*</span>multiplier</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    rects <span class="op">=</span> ax.bar(labelloc<span class="op">+</span>offset, </span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>                   docsl[docsl.high_outsideHit <span class="op">==</span> state].groupby(<span class="st">'high_climRiskExp'</span>)[<span class="ss">f'fs_hit'</span>].mean(), </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>                   width<span class="op">=</span>width, label<span class="op">=</span>label, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(labelloc<span class="op">+</span>width<span class="op">*</span><span class="fl">0.5</span>, [<span class="st">'Low Climate Risk'</span>, <span class="st">'High Climate Risk'</span>])</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">2</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.95</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-164-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="377">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>labelloc <span class="op">=</span> np.arange(<span class="dv">2</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> state, label <span class="kw">in</span> <span class="bu">zip</span>([<span class="va">False</span>, <span class="va">True</span>], [<span class="st">'Low Disclosure Scores'</span>, <span class="st">'High Disclosure Scores'</span>]):</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width<span class="op">*</span>multiplier</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    rects <span class="op">=</span> ax.bar(labelloc<span class="op">+</span>offset, </span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>                   docsl[docsl.high_emissDiscl <span class="op">==</span> state].groupby(<span class="st">'high_climRiskExp'</span>)[<span class="ss">f'fs_hit'</span>].mean(), </span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>                   width<span class="op">=</span>width, label<span class="op">=</span>label, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(labelloc<span class="op">+</span>width<span class="op">*</span><span class="fl">0.5</span>, [<span class="st">'Low Climate Risk'</span>, <span class="st">'High Climate Risk'</span>])</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">2</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.95</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-165-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="378">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>docsl[<span class="st">'high_SRN'</span>] <span class="op">=</span> [x <span class="op">&gt;=</span> docsl[<span class="st">'esrs_emissM'</span>].quantile() <span class="cf">if</span> <span class="op">~</span>np.isnan(x) <span class="cf">else</span> <span class="va">None</span> <span class="cf">for</span> x <span class="kw">in</span> docsl.esrs_emissM]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="457">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>bottom <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> pat <span class="kw">in</span> [<span class="st">'climat'</span>, <span class="st">'emission'</span>, <span class="st">'carbon'</span>, <span class="st">'co2'</span>, <span class="st">'ghg'</span>, <span class="st">'physical risk'</span>, <span class="st">'transition risk'</span>, <span class="st">'regulatory risk'</span>]:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> docsl.groupby(<span class="st">'high_SRN'</span>)[<span class="ss">f'</span><span class="sc">{</span>pat<span class="sc">}</span><span class="ss">_fs_hit'</span>].mean()</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    ax.bar([<span class="st">'Low SRN ESRS Readiness'</span>, <span class="st">'High SRN ESRS Readiness'</span>], means, width<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span>pat, bottom<span class="op">=</span>bottom, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">+=</span> means</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">'y'</span>)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">4</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.10</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202310061341" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202310061341-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;20: SustRep measured by SRN ESRS Readiness</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="380">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>labelloc <span class="op">=</span> np.arange(<span class="dv">2</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>multiplier <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> state, label <span class="kw">in</span> <span class="bu">zip</span>([<span class="va">False</span>, <span class="va">True</span>], [<span class="st">'Low SRN Readiness'</span>, <span class="st">'High SRN Readiness'</span>]):</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    offset <span class="op">=</span> width<span class="op">*</span>multiplier</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    rects <span class="op">=</span> ax.bar(labelloc<span class="op">+</span>offset, </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>                   docsl[docsl.high_SRN <span class="op">==</span> state].groupby(<span class="st">'high_climRiskExp'</span>)[<span class="ss">f'fs_hit'</span>].mean(), </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>                   width<span class="op">=</span>width, label<span class="op">=</span>label, zorder<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    multiplier <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(labelloc<span class="op">+</span>width<span class="op">*</span><span class="fl">0.5</span>, [<span class="st">'Low Climate Risk'</span>, <span class="st">'High Climate Risk'</span>])</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Search hits in FS + Notes"</span>)</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>ax.grid(axis<span class="op">=</span><span class="st">"y"</span>)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>plt.legend(ncol<span class="op">=</span><span class="dv">2</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">0.95</span>,<span class="op">-</span><span class="fl">0.1</span>))</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="output-analyses_files/figure-html/cell-168-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="document-descriptives" class="level2">
<h2 class="anchored" data-anchor-id="document-descriptives">Document descriptives</h2>
<div class="cell" data-execution_count="201">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">3</span>))</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].hist(docsa[<span class="st">'n_pages'</span>], edgecolor<span class="op">=</span><span class="st">"w"</span>, bins<span class="op">=</span><span class="dv">25</span>, color<span class="op">=</span><span class="st">'#a0b1ba'</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="ss">f'Panel A. Total page numbers'</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].hist(docsa[<span class="st">'clean_text_len'</span>], edgecolor<span class="op">=</span><span class="st">"w"</span>, bins<span class="op">=</span><span class="dv">25</span>, color<span class="op">=</span><span class="st">'#a0b1ba'</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>].set_title(<span class="ss">f'Panel B. Clean text lengths'</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].hist(docsa[<span class="st">'avgCleanTextPerPage'</span>], edgecolor<span class="op">=</span><span class="st">"w"</span>, bins<span class="op">=</span><span class="dv">25</span>, color<span class="op">=</span><span class="st">'#a0b1ba'</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].set_title(<span class="ss">f'Panel C. Clean text lengths per page'</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">2</span>].text(x<span class="op">=</span><span class="dv">8400</span>, y<span class="op">=-</span><span class="dv">20</span>, s<span class="op">=</span><span class="ss">f'Cropped at 1,500'</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="ss">f"n=</span><span class="sc">{</span><span class="bu">len</span>(docsa)<span class="sc">}</span><span class="ss"> documents"</span>, y<span class="op">=</span><span class="fl">1.1</span>)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="co">#fig.savefig('figures/fig202309272049.png', dpi=400, bbox_inches='tight')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-fig202309281148" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="output-analyses_files/figure-html/fig-fig202309281148-output-1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;21: Document descriptives</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="576">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="577">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.tokenize <span class="im">import</span> sent_tokenize, word_tokenize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> sent_tokenize(docsa.iloc[<span class="dv">0</span>][<span class="st">'fs_text'</span>])</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>